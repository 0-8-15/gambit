#! /bin/sh

# Copyright (c) 1994-2007 by Marc Feeley, All Rights Reserved.

echo "executing $SCRIPT_NAME"

PROGRAMS="@PROGRAMS@"
BIN_DIR="@BIN_DIR@"
INSTALL_DIR="@INSTALL_DIR@"
GAMBC_BIN_DIR="$INSTALL_DIR/current/bin"

PROGRAMS_EXISTING_CORRECT=""
PROGRAMS_EXISTING_INCORRECT=""
PROGRAMS_MISSING=""
FIRST_EXISTING_INCORRECT=""

i=0

for prog in $PROGRAMS ; do

  if [ -e "$BIN_DIR/$prog" ] ; then
    if [ -L "$BIN_DIR/$prog" -a "`readlink \"$BIN_DIR/$prog\"`" == "$GAMBC_BIN_DIR/$prog" ] ; then
      PROGRAMS_EXISTING_CORRECT="$PROGRAMS_EXISTING_CORRECT $prog"
    else
      PROGRAMS_EXISTING_INCORRECT="$PROGRAMS_EXISTING_INCORRECT $prog"
      if [ "$FIRST_EXISTING_INCORRECT" == "" ] ; then
        FIRST_EXISTING_INCORRECT="$i"
      fi
    fi
  else
    PROGRAMS_MISSING="$PROGRAMS_MISSING $prog"
  fi

  i=`expr $i + 1`

done

if [ "$FIRST_EXISTING_INCORRECT" != "" ] ; then
  for prog in $PROGRAMS_EXISTING_INCORRECT ; do
    echo "The installation process is being aborted because the file $BIN_DIR/$prog exists and it was not created by the Gambit-C installer."
  done
  exit `expr $FIRST_EXISTING_INCORRECT + 16 + 96`
fi

echo "EXISTING_CORRECT   = $PROGRAMS_EXISTING_CORRECT"
echo "EXISTING_INCORRECT = $PROGRAMS_EXISTING_INCORRECT"
echo "MISSING            = $PROGRAMS_MISSING"

exit 0
